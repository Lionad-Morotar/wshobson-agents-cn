使用现代 SRE 实践协调多代理事件响应，实现快速解决和学习：

[扩展思考：此工作流实施遵循现代 SRE 原则的全面事件指挥系统 (ICS)。多个专业代理通过定义的阶段协作：检测/分流、调查/缓解、沟通/协调以及解决/事后分析。工作流程强调在不牺牲准确性的前提下保持速度，维持清晰的沟通渠道，并通过无责备事后分析和系统性改进确保每个事件都成为学习机会。]

## 配置

### 严重性级别

- **P0/SEV-1**：完全中断、安全漏洞、数据丢失 - 立即全员响应
- **P1/SEV-2**：主要降级、重大用户影响 - 需要快速响应
- **P2/SEV-3**：次要降级、有限影响 - 标准响应
- **P3/SEV-4**：外观问题、无用户影响 - 计划解决

### 事件类型

- 性能降级
- 服务中断
- 安全事件
- 数据完整性问题
- 基础设施故障
- 第三方服务中断

## 第一阶段：检测和分流

### 1. 事件检测和分类

- 使用 Task 工具，设置 subagent_type="incident-responder"
- 提示："紧急：检测和分类事件：$ARGUMENTS。分析来自 PagerDuty/Opsgenie/监控的告警。确定：1) 事件严重性 (P0-P3)，2) 受影响的服务和依赖关系，3) 用户影响和业务风险，4) 所需的初始事件指挥结构。检查错误预算和 SLO 违规。"
- 输出：严重性分类、影响评估、事件指挥分配、SLO 状态
- 上下文：初始告警、监控仪表板、最近的变更

### 2. 可观察性分析

- 使用 Task 工具，设置 subagent_type="observability-monitoring::observability-engineer"
- 提示："为事件：$ARGUMENTS 执行快速可观察性扫描。查询：1) 分布式追踪 (OpenTelemetry/Jaeger)，2) 指标关联 (Prometheus/Grafana/DataDog)，3) 日志聚合 (ELK/Splunk)，4) APM 数据，5) 真实用户监控。识别异常、错误模式和服务降级点。"
- 输出：可观察性发现、异常检测、服务健康矩阵、追踪分析
- 上下文：步骤 1 的严重性级别、受影响的服务

### 3. 初始缓解

- 使用 Task 工具，设置 subagent_type="incident-responder"
- 提示："为 P$SEVERITY 事件：$ARGUMENTS 实施立即缓解。行动：1) 如需要则流量限流/重新路由，2) 受影响功能的功能标志禁用，3) 断路器激活，4) 最近部署的回滚评估，5) 如与容量相关则扩展资源。优先考虑用户体验恢复。"
- 输出：已采取的缓解行动、已应用的临时修复、回滚决策
- 上下文：可观察性发现、严重性分类

## 第二阶段：调查和根本原因分析

### 4. 深度系统调试

- 使用 Task 工具，设置 subagent_type="error-debugging::debugger"
- 提示："使用可观察性数据对事件：$ARGUMENTS 进行深度调试。调查：1) 堆栈跟踪和错误日志，2) 数据库查询性能和锁，3) 网络延迟和超时，4) 内存泄漏和 CPU 峰值，5) 依赖失败和级联错误。应用五个为什么分析。"
- 输出：根本原因识别、促成因素、依赖影响图
- 上下文：可观察性分析、缓解状态

### 5. 安全评估

- 使用 Task 工具，设置 subagent_type="security-scanning::security-auditor"
- 提示："评估事件：$ARGUMENTS 的安全影响。检查：1) DDoS 攻击指示器，2) 身份验证/授权失败，3) 数据暴露风险，4) 证书问题，5) 可疑访问模式。审查 WAF 日志、安全组和审计跟踪。"
- 输出：安全评估、漏洞分析、漏洞识别
- 上下文：根本原因发现、系统日志

### 6. 性能工程分析

- 使用 Task 工具，设置 subagent_type="application-performance::performance-engineer"
- 提示："分析事件：$ARGUMENTS 的性能方面。检查：1) 资源利用率模式，2) 查询优化机会，3) 缓存有效性，4) 负载均衡器健康，5) CDN 性能，6) 自动扩展触发器。识别瓶颈和容量问题。"
- 输出：性能瓶颈、资源建议、优化机会
- 上下文：调试发现、当前缓解状态

## 第三阶段：解决和恢复

### 7. 修复实施

- 使用 Task 工具，设置 subagent_type="backend-development::backend-architect"
- 提示："基于根本原因为事件：$ARGUMENTS 设计和实施生产修复。要求：1) 快速部署的最小可行修复，2) 风险评估和回滚能力，3) 带监控的分阶段推出计划，4) 验证标准和健康检查。考虑即时修复和长期解决方案。"
- 输出：修复实施、部署策略、验证计划、回滚程序
- 上下文：根本原因分析、性能发现、安全评估

### 8. 部署和验证

- 使用 Task 工具，设置 subagent_type="deployment-strategies::deployment-engineer"
- 提示："为事件修复：$ARGUMENTS 执行紧急部署。流程：1) 蓝绿或金丝雀部署，2) 带监控的渐进式推出，3) 每个阶段的健康检查验证，4) 配置回滚触发器，5) 部署期间实时监控。与事件指挥协调。"
- 输出：部署状态、验证结果、监控仪表板、回滚就绪
- 上下文：修复实施、当前系统状态

## 第四阶段：沟通和协调

### 9. 利益相关者沟通

- 使用 Task 工具，设置 subagent_type="content-marketing::content-marketer"
- 提示："管理事件：$ARGUMENTS 的沟通。创建：1) 状态页更新（面向公众），2) 内部工程更新（技术细节），3) 高管摘要（业务影响/预计时间），4) 客户支持简报（谈话要点），5) 带关键决策的时间线文档。根据严重性每 15-30 分钟更新。"
- 输出：沟通产物、状态更新、利益相关者简报、时间线日志
- 上下文：所有先前阶段、当前解决状态

### 10. 客户影响评估

- 使用 Task 工具，设置 subagent_type="incident-responder"
- 提示："评估和记录事件：$ARGUMENTS 的客户影响。分析：1) 受影响的用户细分和地理位置，2) 失败的事务或数据丢失，3) SLA 违规和合同影响，4) 客户支持工单量，5) 收入影响估算。准备主动客户外联列表。"
- 输出：客户影响报告、SLA 分析、外联建议
- 上下文：解决进度、沟通状态

## 第五阶段：事后分析和预防

### 11. 无责备事后分析

- 使用 Task 工具，设置 subagent_type="documentation-generation::docs-architect"
- 提示："对事件：$ARGUMENTS 进行无责备事后分析。记录：1) 带决策的完整事件时间线，2) 根本原因和促成因素（系统关注），3) 响应中做得好的地方，4) 可以改进的地方，5) 带所有者和截止日期的行动项，6) 团队教育的经验教训。遵循 SRE 事后分析最佳实践。"
- 输出：事后分析文档、行动项列表、流程改进、培训需求
- 上下文：完整事件历史、所有代理输出

### 12. 监控和告警增强

- 使用 Task 工具，设置 subagent_type="observability-monitoring::observability-engineer"
- 提示："增强监控以防止：$ARGUMENTS 复发。实施：1) 早期检测的新告警，2) 如需要则 SLI/SLO 调整，3) 可见性的仪表板改进，4) 运维手册自动化机会，5) 用于测试的混沌工程场景。确保告警可操作并减少噪音。"
- 输出：新监控配置、告警规则、仪表板更新、运维手册自动化
- 上下文：事后分析发现、根本原因分析

### 13. 系统加固

- 使用 Task 工具，设置 subagent_type="backend-development::backend-architect"
- 提示："设计系统改进以防止事件：$ARGUMENTS。提议：1) 弹性架构变更（断路器、舱壁），2) 优雅降级策略，3) 容量规划调整，4) 技术债务优先级排序，5) 依赖减少机会。创建实施路线图。"
- 输出：架构改进、弹性模式、技术债务项、路线图
- 上下文：事后分析行动项、性能分析

## 成功标准

### 即时成功（事件期间）

- 在 SLA 目标内恢复服务
- 5 分钟内准确分类严重性
- 每 15-30 分钟利益相关者沟通
- 无级联故障或事件升级
- 维持清晰的事件指挥结构

### 长期成功（事件后）

- 48 小时内全面事后分析
- 所有行动项已分配截止日期
- 1 周内部署监控改进
- 完成运维手册更新
- 基于经验教训进行团队培训
- 评估并传达错误预算影响

## 协调协议

### 事件指挥结构

- **事件指挥官**：决策权威、协调
- **技术负责人**：技术调查和解决
- **沟通负责人**：利益相关者更新
- **主题专家**：特定系统专业知识

### 沟通渠道

- 作战室（Slack/Teams 频道或 Zoom）
- 状态页更新（StatusPage、Statusly）
- PagerDuty/Opsgenie 用于告警
- Confluence/Notion 用于文档

### 移交要求

- 每个阶段为下一个提供清晰的上下文
- 所有发现记录在共享事件文档中
- 为事后分析记录决策理由
- 为所有重要事件添加时间戳

需要立即响应的生产事件：$ARGUMENTS
