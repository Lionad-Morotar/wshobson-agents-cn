---
description: "显示项目状态、活跃 tracks 和下一步操作"
argument-hint: "[track-id] [--detailed]"
---

# Conductor 状态

显示 Conductor 项目的当前状态，包括整体进度、活跃 tracks 和下一步操作。

## 飞行前检查

1. 验证 Conductor 已初始化：
   - 检查 `conductor/product.md` 是否存在
   - 检查 `conductor/tracks.md` 是否存在
   - 如果缺失：显示错误并建议先运行 `/conductor:setup`

2. 检查是否有任何 tracks：
   - 读取 `conductor/tracks.md`
   - 如果没有注册的 tracks：显示设置完成消息并建议创建第一个 track

## 数据收集

### 1. 项目信息

读取 `conductor/product.md` 并提取：

- 项目名称
- 项目描述

### 2. Tracks 概览

读取 `conductor/tracks.md` 并解析：

- 总 track 数量
- 已完成的 tracks（标记为 `[x]`）
- 进行中的 tracks（标记为 `[~]`）
- 待处理的 tracks（标记为 `[ ]`）

### 3. 详细 Track 分析

对于 `conductor/tracks/` 中的每个 track：

读取 `conductor/tracks/{trackId}/plan.md`：

- 统计总任务数（匹配 `- [x]`、`- [~]`、`- [ ]` 且带有 Task 前缀的行）
- 统计已完成任务（`[x]`）
- 统计进行中任务（`[~]`）
- 统计待处理任务（`[ ]`）
- 识别当前阶段（第一个有未完成任务的阶段）
- 识别下一个待处理任务

读取 `conductor/tracks/{trackId}/metadata.json`：

- Track 类型（feature、bug、chore、refactor）
- 创建日期
- 最后更新日期
- 状态

读取 `conductor/tracks/{trackId}/spec.md`：

- 检查是否有任何标注的阻塞项或依赖项

### 4. 阻塞检测

扫描潜在的阻塞项：

- 标记有 `BLOCKED:` 前缀的任务
- 对未完成 tracks 的依赖
- 失败的验证任务

## 输出格式

### 完整项目状态（无参数）

```
================================================================================
                        项目状态：{项目名称}
================================================================================
最后更新：{当前时间戳}

--------------------------------------------------------------------------------
                              整体进度
--------------------------------------------------------------------------------

Tracks：     {已完成}/{总数} 已完成（{百分比}%）
任务：      {已完成}/{总数} 已完成（{百分比}%）

进度：   [##########..........] {百分比}%

--------------------------------------------------------------------------------
                              Track 摘要
--------------------------------------------------------------------------------

| 状态 | Track ID          | 类型    | 任务      | 最后更新 |
|--------|-------------------|---------|------------|--------------|
| [x]    | auth_20250110     | feature | 12/12 (100%)| 2025-01-12  |
| [~]    | dashboard_20250112| feature | 7/15 (47%) | 2025-01-15  |
| [ ]    | nav-fix_20250114  | bug     | 0/4 (0%)   | 2025-01-14  |

--------------------------------------------------------------------------------
                              当前焦点
--------------------------------------------------------------------------------

活跃 Track：  dashboard_20250112 - Dashboard 功能
当前阶段：阶段 2：核心组件
当前任务：  [~] 任务 2.3：实现图表渲染

阶段内进度：
  - [x] 任务 2.1：创建 dashboard 布局
  - [x] 任务 2.2：添加数据获取 hooks
  - [~] 任务 2.3：实现图表渲染
  - [ ] 任务 2.4：添加过滤控件

--------------------------------------------------------------------------------
                              下一步操作
--------------------------------------------------------------------------------

1. 完成：任务 2.3 - 实现图表渲染 (dashboard_20250112)
2. 然后：任务 2.4 - 添加过滤控件 (dashboard_20250112)
3. 阶段 2 完成后：阶段验证检查点

--------------------------------------------------------------------------------
                               阻塞项
--------------------------------------------------------------------------------

{如果发现阻塞项：}
! 已阻塞：dashboard_20250112 中的任务 3.1 依赖于 api_20250111（未完成）

{如果没有阻塞项：}
未发现阻塞项。

================================================================================
命令：/conductor:implement {trackId} | /conductor:new-track | /conductor:revert
================================================================================
```

### 单个 Track 状态（带 track-id 参数）

```
================================================================================
                    Track 状态：{Track 标题}
================================================================================
Track ID：    {trackId}
类型：        {feature|bug|chore|refactor}
状态：      {待处理|进行中|已完成}
创建：     {日期}
更新：     {日期}

--------------------------------------------------------------------------------
                              规范
--------------------------------------------------------------------------------

摘要：{来自 spec.md 的简要摘要}

验收标准：
  - [x] {标准 1}
  - [ ] {标准 2}
  - [ ] {标准 3}

--------------------------------------------------------------------------------
                              实施
--------------------------------------------------------------------------------

总体：    {已完成}/{总数} 任务（{百分比}%）
进度：   [##########..........] {百分比}%

## 阶段 1：{阶段名称} [已完成]
  - [x] 任务 1.1：{描述}
  - [x] 任务 1.2：{描述}
  - [x] 验证：{描述}

## 阶段 2：{阶段名称} [进行中]
  - [x] 任务 2.1：{描述}
  - [~] 任务 2.2：{描述}  <-- 当前
  - [ ] 任务 2.3：{描述}
  - [ ] 验证：{描述}

## 阶段 3：{阶段名称} [待处理]
  - [ ] 任务 3.1：{描述}
  - [ ] 任务 3.2：{描述}
  - [ ] 验证：{描述}

--------------------------------------------------------------------------------
                              Git 历史
--------------------------------------------------------------------------------

相关提交：
  abc1234 - feat: add login form ({trackId})
  def5678 - feat: add password validation ({trackId})
  ghi9012 - chore: mark task 1.2 complete ({trackId})

--------------------------------------------------------------------------------
                              下一步
--------------------------------------------------------------------------------

1. 当前：任务 2.2 - {描述}
2. 下一步：任务 2.3 - {描述}
3. 阶段 2 验证待处理

================================================================================
命令：/conductor:implement {trackId} | /conductor:revert {trackId}
================================================================================
```

## 状态标记图例

如果有帮助，在底部显示：

```
图例：
  [x] = 已完成
  [~] = 进行中
  [ ] = 待处理
  [!] = 已阻塞
```

## 错误状态

### 未找到 Tracks

```
================================================================================
                        项目状态：{项目名称}
================================================================================

Conductor 已设置但尚未创建任何 tracks。

入门：
  /conductor:new-track "您的功能描述"

================================================================================
```

### Conductor 未初始化

```
错误：Conductor 未初始化

找不到 conductor/product.md

运行 /conductor:setup 为此项目初始化 Conductor。
```

### 未找到 Track（带参数）

```
错误：未找到 track：{参数}

可用的 tracks：
  - auth_20250115
  - dashboard_20250112
  - nav-fix_20250114

用法：/conductor:status [track-id]
```

## 计算逻辑

### 任务计数

```
对于每个 plan.md：
  - 已完成：统计匹配 /^- \[x\] Task/ 的行
  - 进行中：统计匹配 /^- \[~\] Task/ 的行
  - 待处理：统计匹配 /^- \[ \] Task/ 的行
  - 总计：已完成 + 进行中 + 待处理
```

### 阶段检测

```
当前阶段 = 第一个后跟任何未完成任务（[ ] 或 [~]）的阶段标题
```

### 进度条

```
filled = floor((已完成 / 总计) * 20)
empty = 20 - filled
bar = "[" + "#".repeat(filled) + ".".repeat(empty) + "]"
```

## 快速模式

如果使用 `--quick` 或 `-q` 调用：

```
{项目名称}：{已完成}/{总数} 任务（{百分比}%）
活跃：{trackId} - 任务 {X.Y}
```

## JSON 输出

如果使用 `--json` 调用：

```json
{
  "project": "{名称}",
  "timestamp": "ISO_TIMESTAMP",
  "tracks": {
    "total": N,
    "completed": X,
    "in_progress": Y,
    "pending": Z
  },
  "tasks": {
    "total": M,
    "completed": A,
    "in_progress": B,
    "pending": C
  },
  "current": {
    "track": "{trackId}",
    "phase": N,
    "task": "{X.Y}"
  },
  "blockers": []
}
```
