# API 设计检查清单

## 实施前审查

### 资源设计

- [ ] 资源是名词，而非动词
- [ ] 集合使用复数名称
- [ ] 所有端点命名一致
- [ ] 清晰的资源层次结构（避免深度嵌套超过 2 层）
- [ ] 所有 CRUD 操作正确映射到 HTTP 方法

### HTTP 方法

- [ ] GET 用于检索（安全、幂等）
- [ ] POST 用于创建
- [ ] PUT 用于完全替换（幂等）
- [ ] PATCH 用于部分更新
- [ ] DELETE 用于删除（幂等）

### 状态码

- [ ] 200 OK 表示成功的 GET/PATCH/PUT
- [ ] 201 Created 表示 POST
- [ ] 204 No Content 表示 DELETE
- [ ] 400 Bad Request 表示格式错误的请求
- [ ] 401 Unauthorized 表示缺少身份验证
- [ ] 403 Forbidden 表示权限不足
- [ ] 404 Not Found 表示资源缺失
- [ ] 422 Unprocessable Entity 表示验证错误
- [ ] 429 Too Many Requests 表示速率限制
- [ ] 500 Internal Server Error 表示服务器问题

### 分页

- [ ] 所有集合端点已分页
- [ ] 定义了默认页面大小（例如，20）
- [ ] 强制执行最大页面大小（例如，100）
- [ ] 包含分页元数据（总数、页数等）
- [ ] 选择了基于游标或基于偏移量的模式

### 过滤和排序

- [ ] 用于过滤的查询参数
- [ ] 支持排序参数
- [ ] 用于全文搜索的搜索参数
- [ ] 支持字段选择（稀疏字段集）

### 版本控制

- [ ] 定义了版本控制策略（URL/标头/查询）
- [ ] 所有端点包含版本
- [ ] 记录了弃用策略

### 错误处理

- [ ] 一致的错误响应格式
- [ ] 详细的错误消息
- [ ] 字段级验证错误
- [ ] 用于客户端处理的错误代码
- [ ] 错误响应中的时间戳

### 身份验证和授权

- [ ] 定义了身份验证方法（Bearer 令牌、API 密钥）
- [ ] 所有端点的授权检查
- [ ] 正确使用 401 vs 403
- [ ] 处理了令牌过期

### 速率限制

- [ ] 定义了每个端点/用户的速率限制
- [ ] 包含速率限制标头
- [ ] 429 状态码表示超出限制
- [ ] 提供了 Retry-After 标头

### 文档

- [ ] 生成了 OpenAPI/Swagger 规范
- [ ] 记录了所有端点
- [ ] 提供了请求/响应示例
- [ ] 记录了错误响应
- [ ] 记录了身份验证流程

### 测试

- [ ] 业务逻辑的单元测试
- [ ] 端点的集成测试
- [ ] 测试了错误场景
- [ ] 覆盖了边缘情况
- [ ] 重型端点的性能测试

### 安全性

- [ ] 所有字段的输入验证
- [ ] SQL 注入防护
- [ ] XSS 防护
- [ ] 正确配置 CORS
- [ ] 强制使用 HTTPS
- [ ] 敏感数据不在 URL 中
- [ ] 响应中无秘密

### 性能

- [ ] 优化了数据库查询
- [ ] 防止了 N+1 查询
- [ ] 定义了缓存策略
- [ ] 适当设置了缓存标头
- [ ] 大响应已分页

### 监控

- [ ] 实现了日志记录
- [ ] 配置了错误跟踪
- [ ] 收集了性能指标
- [ ] 健康检查端点可用
- [ ] 为错误配置了告警

## GraphQL 专用检查

### Schema 设计

- [ ] 使用了 Schema 优先方法
- [ ] 正确定义了类型
- [ ] 确定了非空 vs 可空
- [ ] 适当使用接口/联合
- [ ] 定义了自定义标量

### 查询

- [ ] 查询深度限制
- [ ] 查询复杂度分析
- [ ] DataLoaders 防止 N+1
- [ ] 选择了分页模式（Relay/偏移）

### 变更

- [ ] 定义了输入类型
- [ ] 包含错误的负载类型
- [ ] 乐观响应支持
- [ ] 考虑了幂等性

### 性能

- [ ] 所有关联关系的 DataLoader
- [ ] 启用了查询批处理
- [ ] 考虑了持久化查询
- [ ] 实现了响应缓存

### 文档

- [ ] 记录了所有字段
- [ ] 标记了弃用项
- [ ] 提供了示例
- [ ] 启用了 Schema 内省